<style>

</style>

<div class="content">
    <div class="row">
        <div class="col-md-3 col-sm-6 col-12">
            <div class="info-box">
                <span class="info-box-icon bg-info">
                    <svg height="60px" width="60px" fill="#ffffff" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                        <g id="SVGRepo_iconCarrier">
                            <path d="M16.4226 3.33975C16.7799 3.33975 17.11 3.53035 17.2887 3.83975L21.7113 11.5C21.89 11.8094 21.89 12.1906 21.7113 12.5L17.2887 20.1603C17.11 20.4697 16.7799 20.6603 16.4227 20.6603H7.57735C7.22009 20.6603 6.88996 20.4697 6.71133 20.1603L2.28868 12.5C2.11004 12.1906 2.11004 11.8094 2.28868 11.5L6.71132 3.83975C6.88996 3.53035 7.22008 3.33975 7.57735 3.33975L16.4226 3.33975Z"></path>
                        </g>
                    </svg>
                </span>

                <div class="info-box-content">
                    <span class="info-box-number">Phòng ban</span>
                    <span class="info-box-text" id="count_departments"></span>
                </div>
                <!-- /.info-box-content -->
            </div>
            <!-- /.info-box -->
        </div>
        <!-- /.col -->
        <div class="col-md-3 col-sm-6 col-12">
            <div class="info-box">
                <span class="info-box-icon bg-success">
                    <svg height="60px" width="60px" version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve" fill="#ffffff" stroke="#ffffff">
                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                        <g id="SVGRepo_iconCarrier">
                            <style type="text/css">
                                .st0 {
                                    fill: #ffffff;
                                }
                            </style>
                            <g>
                                <path class="st0" d="M256.008,411.524c54.5,0,91.968-7.079,92.54-13.881c2.373-28.421-34.508-43.262-49.381-48.834 c-7.976-2.984-19.588-11.69-19.588-17.103c0-3.587,0-8.071,0-14.214c4.611-5.119,8.095-15.532,10.183-27.317 c4.857-1.738,7.627-4.524,11.095-16.65c3.69-12.93-5.548-12.5-5.548-12.5c7.468-24.715-2.357-47.944-18.825-46.246 c-11.358-19.857-49.397,4.54-61.31,2.841c0,6.818,2.834,11.92,2.834,11.92c-4.143,7.882-2.548,23.564-1.389,31.485 c-0.667,0-9.016,0.079-5.468,12.5c3.452,12.126,6.23,14.912,11.088,16.65c2.079,11.786,5.571,22.198,10.198,27.317 c0,6.143,0,10.627,0,14.214c0,5.413-12.35,14.548-19.611,17.103c-14.953,5.262-51.746,20.413-49.373,48.834 C164.024,404.444,201.491,411.524,256.008,411.524z"></path>
                                <path class="st0" d="M404.976,56.889h-75.833v16.254c0,31.365-25.524,56.889-56.889,56.889h-32.508 c-31.366,0-56.889-25.524-56.889-56.889V56.889h-75.834c-25.444,0-46.071,20.627-46.071,46.071v362.969 c0,25.444,20.627,46.071,46.071,46.071h297.952c25.445,0,46.072-20.627,46.072-46.071V102.96 C451.048,77.516,430.421,56.889,404.976,56.889z M402.286,463.238H109.714V150.349h292.572V463.238z"></path>
                                <path class="st0" d="M239.746,113.778h32.508c22.405,0,40.635-18.23,40.635-40.635V40.635C312.889,18.23,294.659,0,272.254,0 h-32.508c-22.406,0-40.635,18.23-40.635,40.635v32.508C199.111,95.547,217.341,113.778,239.746,113.778z M231.619,40.635 c0-4.492,3.634-8.127,8.127-8.127h32.508c4.492,0,8.127,3.635,8.127,8.127v16.254c0,4.492-3.635,8.127-8.127,8.127h-32.508 c-4.493,0-8.127-3.635-8.127-8.127V40.635z"></path>
                            </g>
                        </g>
                    </svg>
                </span>

                <div class="info-box-content">
                    <span class="info-box-number">Nhân sự</span>
                    <span class="info-box-text" id="count_employees"></span>
                </div>
                <!-- /.info-box-content -->
            </div>
            <!-- /.info-box -->
        </div>
        <!-- /.col -->
        <div class="col-md-3 col-sm-6 col-12">
            <div class="info-box">
                <span class="info-box-icon bg-warning">
                    <svg width="60px" height="60px" viewBox="0 0 1024 1024" class="icon" version="1.1" xmlns="http://www.w3.org/2000/svg" fill="#000000">
                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                        <g id="SVGRepo_iconCarrier">
                            <path d="M905.92 237.76a32 32 0 0 0-52.48 36.48A416 416 0 1 1 96 512a418.56 418.56 0 0 1 297.28-398.72 32 32 0 1 0-18.24-61.44A480 480 0 1 0 992 512a477.12 477.12 0 0 0-86.08-274.24z" fill="#ffffff"></path>
                            <path d="M630.72 113.28A413.76 413.76 0 0 1 768 185.28a32 32 0 0 0 39.68-50.24 476.8 476.8 0 0 0-160-83.2 32 32 0 0 0-18.24 61.44zM489.28 86.72a36.8 36.8 0 0 0 10.56 6.72 30.08 30.08 0 0 0 24.32 0 37.12 37.12 0 0 0 10.56-6.72A32 32 0 0 0 544 64a33.6 33.6 0 0 0-9.28-22.72A32 32 0 0 0 505.6 32a20.8 20.8 0 0 0-5.76 1.92 23.68 23.68 0 0 0-5.76 2.88l-4.8 3.84a32 32 0 0 0-6.72 10.56A32 32 0 0 0 480 64a32 32 0 0 0 2.56 12.16 37.12 37.12 0 0 0 6.72 10.56zM355.84 313.6a36.8 36.8 0 0 0-13.12 18.56l-107.52 312.96a37.44 37.44 0 0 0 2.56 35.52 32 32 0 0 0 24.96 10.56 27.84 27.84 0 0 0 17.28-5.76 43.84 43.84 0 0 0 10.56-13.44 100.16 100.16 0 0 0 7.04-15.36l4.8-12.8 17.6-49.92h118.72l24.96 69.76a45.76 45.76 0 0 0 10.88 19.2 28.8 28.8 0 0 0 20.48 8.32h2.24a27.52 27.52 0 0 0 27.84-15.68 41.28 41.28 0 0 0 0-29.44l-107.84-313.6a36.8 36.8 0 0 0-13.44-19.2 44.16 44.16 0 0 0-48 0.32z m24.32 96l41.6 125.44h-83.2zM594.88 544a66.56 66.56 0 0 0 25.6 4.16h62.4v78.72a29.12 29.12 0 0 0 32 32 26.24 26.24 0 0 0 27.2-16.32 73.28 73.28 0 0 0 4.16-26.24v-66.88h73.6a27.84 27.84 0 0 0 29.44-32 26.56 26.56 0 0 0-16-27.2 64 64 0 0 0-23.04-4.16h-64v-75.84a28.16 28.16 0 0 0-32-30.08 26.56 26.56 0 0 0-27.2 15.68 64 64 0 0 0-4.16 24v66.88h-62.72a69.44 69.44 0 0 0-25.6 4.16 26.56 26.56 0 0 0-15.68 27.2 25.92 25.92 0 0 0 16 25.92z" fill="#ffffff"></path>
                        </g>
                    </svg>
                    </i></span>

                <div class="info-box-content">
                    <span class="info-box-number">Điểm trung bình</span>
                    <span class="info-box-text" id="avg_score"></span>
                </div>
                <!-- /.info-box-content -->
            </div>
            <!-- /.info-box -->
        </div>
        <!-- /.col -->
        <div class="col-md-3 col-sm-6 col-12">
            <div class="info-box">
                <span class="info-box-icon bg-danger">
                    <svg width="60px" height="60px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                        <g id="SVGRepo_iconCarrier">
                            <path d="M11.1459 12.5225C11.5259 11.8408 11.7159 11.5 12 11.5C12.2841 11.5 12.4741 11.8408 12.8541 12.5225L12.9524 12.6989C13.0603 12.8926 13.1143 12.9894 13.1985 13.0533C13.2827 13.1172 13.3875 13.141 13.5972 13.1884L13.7881 13.2316C14.526 13.3986 14.895 13.482 14.9828 13.7643C15.0706 14.0466 14.819 14.3407 14.316 14.929L14.1858 15.0812C14.0429 15.2483 13.9714 15.3319 13.9392 15.4353C13.9071 15.5387 13.9179 15.6502 13.9395 15.8733L13.9592 16.0763C14.0352 16.8612 14.0733 17.2536 13.8435 17.4281C13.6136 17.6025 13.2682 17.4435 12.5773 17.1254L12.3986 17.0431C12.2022 16.9527 12.1041 16.9075 12 16.9075C11.8959 16.9075 11.7978 16.9527 11.6014 17.0431L11.4227 17.1254C10.7318 17.4435 10.3864 17.6025 10.1565 17.4281C9.92674 17.2536 9.96476 16.8612 10.0408 16.0763L10.0605 15.8733C10.0821 15.6502 10.0929 15.5387 10.0608 15.4353C10.0286 15.3319 9.95713 15.2483 9.81418 15.0812L9.68403 14.929C9.18097 14.3407 8.92945 14.0466 9.01723 13.7643C9.10501 13.482 9.47396 13.3986 10.2119 13.2316L10.4028 13.1884C10.6125 13.141 10.7173 13.1172 10.8015 13.0533C10.8857 12.9894 10.9397 12.8926 11.0476 12.6989L11.1459 12.5225Z" stroke="#ffffff" stroke-width="1.5"></path>
                            <path d="M21.8382 11.1263C22.0182 9.2137 22.1082 8.25739 21.781 7.86207C21.604 7.64823 21.3633 7.5172 21.106 7.4946C20.6303 7.45282 20.0329 8.1329 18.8381 9.49307C18.2202 10.1965 17.9113 10.5482 17.5666 10.6027C17.3757 10.6328 17.1811 10.6018 17.0047 10.5131C16.6865 10.3529 16.4743 9.91812 16.0499 9.04851L13.8131 4.46485C13.0112 2.82162 12.6102 2 12 2C11.3898 2 10.9888 2.82162 10.1869 4.46486L7.95007 9.04852C7.5257 9.91812 7.31351 10.3529 6.99526 10.5131C6.81892 10.6018 6.62434 10.6328 6.43337 10.6027C6.08872 10.5482 5.77977 10.1965 5.16187 9.49307C3.96708 8.1329 3.36968 7.45282 2.89399 7.4946C2.63666 7.5172 2.39598 7.64823 2.21899 7.86207C1.8918 8.25739 1.9818 9.2137 2.16181 11.1263L2.391 13.5616C2.76865 17.5742 2.95748 19.5805 4.14009 20.7902C5.32271 22 7.09517 22 10.6401 22H13.3599C16.9048 22 18.6773 22 19.8599 20.7902C20.7738 19.8553 21.0942 18.4447 21.367 16" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round"></path>
                        </g>
                    </svg>
                </span>

                <div class="info-box-content">
                    <span class="info-box-number">Tốt nhất</span>
                    <span class="info-box-text" id="top_department"></span>
                </div>
                <!-- /.info-box-content -->
            </div>
            <!-- /.info-box -->
        </div>
        <!-- /.col -->
    </div>
    <div class="row">
        <div class="col-lg-4 col-md-6 col-sm-12 p-2">
            <div id="chart"></div>

        </div>
        <div class="col-lg-8 col-md-6 col-sm-12 p-2">
            <div id="chart_bar"></div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {

        const config_chart_pie = {
            type: "pie",
            css: "dhx_widget--bordered",
            series: [{
                value: "percentage",
                color: "color",
                text: "score",
                stroke: "#FFFFFF",
                subType: "percentOnly",
                strokeWidth: 2,
            }],
            legend: {
                values: {
                    text: "score",
                    color: "color"
                },
                form: "circle",
                halign: "right",
                valign: "bottom"
            },

        };

        const config_chart_bar = {
            type: "bar",
            css: "dhx_widget--bordered",
            barWidth: 80,
            scales: {
                "left": {
                    maxTicks: 10,
                    max: 10,
                    min: 0
                },
                bottom: {
                    text: "month"
                },
            },
            series: [{
                id: "agv_score",
                value: "agv_score",
                color: "#74A2E7",
                fill: "#74A2E7",
            }],
        };

        const chart_pie = new dhx.Chart("chart", config_chart_pie);
        const chart_bar = new dhx.Chart("chart_bar", config_chart_bar);


        load_pie_chart_data();
        load_bar_chart_data();
        load_overview_data();

        function load_pie_chart_data(filters = []) {
            $.ajax({
                url: "<?= base_url() ?>score/fetch_pie_chart_data",
                data: {
                    filters: filters
                },
                method: 'post',
                dataType: 'json',
                success: function(response) {

                    if (response.success && response.data) {

                        const chartData = response.data.map(function(item) {
                            const randomColor = '#' + Math.floor(Math.random() * 16777215).toString(16);
                            return {
                                id: item.score,
                                percentage: parseFloat(item.percentage).toFixed(2),
                                color: randomColor,
                                score: item.score
                            };
                        });

                        chart_pie.data.parse(chartData);
                    } else {
                        console.error("Error loading pie chart data.");
                    }
                }
            });
        }

        function load_bar_chart_data(filters = []) {
            $.ajax({
                url: "<?= base_url() ?>score/fetch_bar_chart_data",
                data: {
                    filters: filters
                },
                method: 'post',
                dataType: 'json',
                success: function(response) {

                    if (response.success && response.data) {

                        const chartData = response.data.map(function(item) {
                            return {
                                month: item.month.toString().padStart(2, '0') + '/' + item.year,
                                "agv_score": parseFloat(item.average_score).toFixed(2),
                            };
                        });

                        chart_bar.data.parse(chartData);
                    } else {
                        console.error("Error loading pie chart data.");
                    }
                }
            });
        }

        function load_overview_data(filters = []) {
            $.ajax({
                url: "<?= base_url() ?>score/fetch_overview_data",
                data: {
                    filters: filters
                },
                method: 'post',
                dataType: 'json',
                success: function(response) {

                    if (response.success && response.data) {

                        $('#count_employees').text(response.data.count_employees);
                        $('#count_departments').text(response.data.count_departments);
                        $('#top_department').text(response.data.top_department.department_name);
                        $('#avg_score').text(parseFloat(response.data.avg_score.avg_score).toFixed(2));

                    } else {
                        console.error("Error loading overview chart data.");
                    }
                }
            });
        }
    })
</script>